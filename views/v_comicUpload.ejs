<%-include("header")%>
<!-- special css only for upload -->
<style>.files input {
    outline: 2px dashed #92b0b3;
    outline-offset: -10px;
    -webkit-transition: outline-offset .15s ease-in-out, background-color .15s linear;
    transition: outline-offset .15s ease-in-out, background-color .15s linear;
    padding: 120px 0px 85px 35%;
    text-align: center !important;
    margin: 0;
    width: 100% !important;
}
.files input:focus{     outline: 2px dashed #92b0b3;  outline-offset: -10px;
    -webkit-transition: outline-offset .15s ease-in-out, background-color .15s linear;
    transition: outline-offset .15s ease-in-out, background-color .15s linear; border:1px solid #92b0b3;
 }
.files{ position:relative   }
.files:after {  
    pointer-events: none;
    position: absolute;
    top: 60px;
    left: 0;
    width: 50px;
    right: 0;
    height: 56px;
    content: "";
    background-image: url(https://image.flaticon.com/icons/png/128/109/109612.png);
    display: block;
    margin: 0 auto;
    background-size: 100%;
    background-repeat: no-repeat;
}
.color input{ background-color:#f1f1f1;}
.files:before {
    position: absolute;
    bottom: 10px;
    left: 0;  pointer-events: none;
    width: 100%;
    right: 0;
    height: 57px;
    content: " or drag it here. ";
    display: block;
    margin: 0 auto;
    color: #2ea591;
    font-weight: 600;
    text-transform: capitalize;
    text-align: center;
}</style>
  <div class="container content_c mt-3">
        <div class="d-flex align-items-sm-center justify-content-center row col-12 align-middle">




                <div class="d-flex justify-content-center">
                    <% if(typeof msg != 'undefined' && msg != ""){ %>
                    <div class="col-md-6 alert alert-warning"><%=msg%></div>
                    <%}%>

                </div>

                <div class="col-9">
                    <form method="post" enctype="multipart/form-data" onsubmit="return false;">   
                        <div>
                            <div class="progress">
                                <div id="progressBar" class="progress-bar progress-bar-striped bg-success" role="progressbar" style="width: 0%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <h3 id="status"></h3>
                            <p id="loaded_n_total"></p>
                                <div class="form-group files">
                                  <label>Upload Your Comic File </label>
                                  <input name="fileComicUpload" id="file1" type="file" onchange="uploadFile()" class="form-control" accept=".cbz,.cbr">
                                </div>
                                <div>

                                </div>
                        </div>
                    </form>
                    
                </div>
        </div>
  </div>
  <script>

    function _(el) {
      return document.getElementById(el);
    }
    
    function uploadFile() {
      var file = _("file1").files[0];
      
      // Check if a file is selected
      if (!file) {
        _("status").innerHTML = "Please select a file first.";
        return;
      }
      
      // Check file extension
      var fileName = file.name.toLowerCase();
      if (!fileName.endsWith('.cbz') && !fileName.endsWith('.cbr')) {
        _("status").innerHTML = "Please select a .cbz or .cbr file.";
        return;
      }
      
      // alert(file.name+" | "+file.size+" | "+file.type);
      var formdata = new FormData();
      formdata.append("fileComicUpload", file);
      var ajax = new XMLHttpRequest();
      ajax.upload.addEventListener("progress", progressHandler, false);
      ajax.addEventListener("load", completeHandler, false);
      ajax.addEventListener("error", errorHandler, false);
      ajax.addEventListener("abort", abortHandler, false);
      ajax.open("POST", "/comic/upload"); // http://www.developphp.com/video/JavaScript/File-Upload-Progress-Bar-Meter-Tutorial-Ajax-PHP
      //use file_upload_parser.php from above url
      ajax.send(formdata);
    }
    
    function progressHandler(event) {
      _("loaded_n_total").innerHTML = "Uploaded " + (event.loaded/1048576).toFixed(2) + " MB of " + (event.total/1048576).toFixed(2)+" MB";
      var percent = (event.loaded / event.total) * 100;
      //_("progressBar").value = Math.round(percent);
      _("progressBar").style.width = Math.round(percent)+"%";
      _("status").innerHTML = Math.round(percent) + "% uploaded... please wait";
    }
    
    function completeHandler(event) {
        console.log('Upload complete. Status:', event.target.status);
        console.log('Response URL:', event.target.responseURL);
        console.log('Response text:', event.target.responseText);
        
        if (event.target.status === 200) {
            _("status").innerHTML = "Upload successful! Redirecting...";
            location.replace(event.target.responseURL);
        } else {
            _("status").innerHTML = "Upload failed. Please try again.";
        }
    }
    
    function errorHandler(event) {
      console.error('Upload error:', event);
      _("status").innerHTML = "Upload Failed - " + (event.error || 'Unknown error');
    }
    
    function abortHandler(event) {
      console.log('Upload aborted:', event);
      _("status").innerHTML = "Upload Aborted";
    }
    </script>
<%-include("footer")%>